<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clash Mode • Free Fire Tournament</title>
  <meta name="description" content="Clash Squad Free Fire Tournament — Clash Squad 4v4 & 2v2. ₹50 manual UPI entry. Professional event UI." />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg-primary: #05060a;
      --bg-secondary: #0b0f1a;
      --bg-card: rgba(255, 255, 255, 0.03);
      --text-primary: #e8eef7;
      --text-muted: #9aa6b3;
      --accent-gold: #f6c85f;
      --accent-gold-dark: #f39c12;
      --border-light: rgba(255, 255, 255, 0.08);
      --shadow-soft: 0 10px 30px rgba(3, 6, 12, 0.6);
      --shadow-hover: 0 15px 40px rgba(243, 156, 18, 0.2);
      --radius: 16px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: 
        radial-gradient(ellipse at 10% 10%, rgba(243, 156, 18, 0.08) 0%, transparent 50%),
        linear-gradient(180deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .wrap {
      max-width: 1200px;
      width: 100%;
      animation: fadeInUp 0.8s ease-out;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 32px;
      animation: slideInLeft 0.6s ease-out 0.2s both;
    }

    @keyframes slideInLeft {
      from {
        opacity: 0;
        transform: translateX(-50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      width: 64px;
      height: 64px;
      border-radius: 16px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-gold-dark));
      display: flex;
      align-items: center;
      justify-content: center;
      color: #081018;
      font-weight: 900;
      font-size: 24px;
      box-shadow: var(--shadow-soft);
      transition: var(--transition);
    }

    .logo:hover {
      transform: scale(1.05);
      box-shadow: var(--shadow-hover);
    }

    .title {
      font-size: 28px;
      font-weight: 900;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-gold-dark));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: var(--text-muted);
      font-size: 14px;
      font-weight: 500;
    }

    .pool {
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-gold-dark));
      padding: 12px 20px;
      border-radius: 12px;
      color: #07101a;
      font-weight: 800;
      font-size: 18px;
      box-shadow: var(--shadow-soft);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .card {
      background: var(--bg-card);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-light);
      border-radius: var(--radius);
      padding: 32px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 24px;
      animation: slideInRight 0.6s ease-out 0.4s both;
      transition: var(--transition);
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(50px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    h2 {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-primary);
    }

    h2 i {
      color: var(--accent-gold);
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--text-primary);
      font-size: 14px;
    }

    input, select {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: 1px solid var(--border-light);
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-primary);
      font-size: 16px;
      transition: var(--transition);
      margin-bottom: 20px;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--accent-gold);
      box-shadow: 0 0 0 3px rgba(246, 200, 95, 0.1);
      transform: scale(1.02);
    }

    input::placeholder, select::placeholder {
      color: var(--text-muted);
    }

    button {
      cursor: pointer;
      border-radius: 12px;
      padding: 16px 24px;
      font-weight: 700;
      border: none;
      transition: var(--transition);
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
      width: 100%;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-gold-dark));
      color: #07101a;
      box-shadow: var(--shadow-soft);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .btn-primary:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border-light);
      color: var(--text-primary);
      width: auto;
      padding: 12px 20px;
    }

    .btn-ghost:hover {
      border-color: var(--accent-gold);
      color: var(--accent-gold);
      background: rgba(246, 200, 95, 0.1);
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal {
      background: var(--bg-secondary);
      padding: 32px;
      border-radius: var(--radius);
      width: 90%;
      max-width: 500px;
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-soft);
      animation: scaleIn 0.3s ease-out;
    }

    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }

    .modal h3 {
      margin-bottom: 16px;
      color: var(--accent-gold);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .upi-info {
      background: rgba(255, 255, 255, 0.05);
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 20px;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
    }

    .btn-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn-group button {
      flex: 1;
      min-width: 120px;
    }

    .toast {
      position: fixed;
      right: 20px;
      bottom: 20px;
      background: linear-gradient(135deg, #13ce66, #0ad09f);
      color: #021;
      padding: 16px 20px;
      border-radius: 12px;
      font-weight: 800;
      display: none;
      box-shadow: var(--shadow-soft);
      animation: slideInRight 0.3s ease-out, fadeOut 0.3s ease-out 2.7s forwards;
    }

    .toast.error {
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
    }

    @keyframes fadeOut {
      to { opacity: 0; transform: translateX(100%); }
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error-msg {
      background: rgba(231, 76, 60, 0.1);
      border: 1px solid #e74c3c;
      color: #e74c3c;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
      font-size: 14px;
    }

    footer {
      text-align: center;
      color: var(--text-muted);
      font-size: 14px;
      margin-top: 40px;
      opacity: 0.8;
    }

    @media (max-width: 768px) {
      .wrap { padding: 10px; }
      header { flex-direction: column; text-align: center; gap: 12px; }
      .card { padding: 20px; }
      .btn-group { flex-direction: column; }
    }

    /* Additional Advanced Features */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .form-row { grid-template-columns: 1fr; }
    }

    .team-members {
      display: none;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border-light);
    }

    .team-members.active {
      display: block;
      animation: fadeInUp 0.5s ease-out;
    }

    .member-input {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }

    .remove-member {
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-size: 14px;
      transition: var(--transition);
    }

    .remove-member:hover {
      background: #c0392b;
    }

    .view-regs {
      margin-top: 20px;
      background: rgba(255, 255, 255, 0.05);
      padding: 20px;
      border-radius: 12px;
      display: none;
    }

    .regs-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .reg-item {
      background: var(--bg-secondary);
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 8px;
      border-left: 3px solid var(--accent-gold);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">
          <i class="fas fa-fire"></i>
        </div>
        <div>
          <div class="title">Clash Code</div>
          <div class="subtitle">Free Fire Tournament • Clash Squad</div>
        </div>
      </div>
      <div class="pool">
        <i class="fas fa-trophy"></i> Prize Pool ₹200
      </div>
    </header>

    <div class="card">
      <h2><i class="fas fa-user-plus"></i> Register Team — ₹50 Entry Fee</h2>
      <div id="errorMsg" class="error-msg"></div>
      <form id="regForm">
        <label for="mode">Select Mode</label>
        <select id="mode" required>
          <option value="">Choose your battle mode</option>
          <option value="4v4">Clash Squad 4v4</option>
          <option value="2v2">Clash Squad 2v2</option>
        </select>

        <div class="form-row">
          <div>
            <label for="team">Team / Duo Name</label>
            <input id="team" type="text" required placeholder="Enter your team name" />
          </div>
          <div>
            <label for="leader">Team Leader Name</label>
            <input id="leader" type="text" required placeholder="Leader's full name" />
          </div>
        </div>

        <label for="phone">Contact Phone (India)</label>
        <input id="phone" type="tel" required pattern="^(\+91[\s-]?)?[6-9]\d{9}$" placeholder="+91 12345 67890" />

        <!-- Dynamic Team Members -->
        <div class="team-members" id="teamMembers">
          <h3 style="margin-bottom: 16px; color: var(--accent-gold);"><i class="fas fa-users"></i> Add Team Members</h3>
          <div id="membersList"></div>
          <button type="button" id="addMember" class="btn-ghost" style="width: auto; margin-top: 10px;">
            <i class="fas fa-plus"></i> Add Member
          </button>
        </div>

        <button type="button" id="payNow" class="btn-primary">
          <i class="fas fa-credit-card"></i> Proceed to Payment
        </button>
      </form>

      <!-- View Registrations (Demo) -->
      <div class="view-regs" id="viewRegs">
        <h3 style="margin-bottom: 16px; color: var(--accent-gold);"><i class="fas fa-list"></i> Registered Teams</h3>
        <div class="regs-list" id="regsList"></div>
      </div>
      <button type="button" id="toggleRegs" class="btn-ghost" style="width: auto; margin-top: 20px;">
        <i class="fas fa-eye"></i> View Registrations
      </button>
    </div>

    <footer>© 2025 Clash Code • All rights reserved | <a href="#" style="color: var(--accent-gold);">Privacy Policy</a></footer>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <h3><i class="fas fa-mobile-alt"></i> Complete Payment via UPI</h3>
      <div class="upi-info">
        Send exactly ₹50 to: <br>
        <strong id="upiId">princegamerb12@paytm</strong>
      </div>
      <p style="text-align: center; color: var(--text-muted); font-size: 14px; margin-bottom: 20px;">
        After payment, confirm below to register.
      </p>
      <div class="btn-group">
        <button id="copyUpi" class="btn-ghost">
          <i class="fas fa-copy"></i> Copy UPI ID
        </button>
        <button id="confirmPay" class="btn-primary">
          <span id="confirmText">✅ Confirm Payment</span>
          <span id="loadingSpinner" class="loading" style="display: none;"></span>
        </button>
      </div>
      <button id="closeModal" class="btn-ghost" style="margin-top: 16px; width: 100%;">
        <i class="fas fa-times"></i> Cancel
      </button>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <i class="fas fa-check-circle"></i> Registration Confirmed! See you in the arena.
  </div>

  <!-- Firebase Modular SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDWlHbwGJhS1jb06U15MLlv4AHOL-TIzi0",
      authDomain: "ff-tournament-4541f.firebaseapp.com",
      databaseURL: "https://ff-tournament-4541f-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "ff-tournament-4541f",
      storageBucket: "ff-tournament-4541f.firebasestorage.app",
      messagingSenderId: "1025856159650",
      appId: "1:1025856159650:web:06b47ff8f7f80ad0c03cfb",
      measurementId: "G-5YLW1NR50Q"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);

    // Expose to global scope
    window.firebaseDb = db;
    window.firebaseRef = ref;
    window.firebasePush = push;
    window.firebaseOnValue = onValue;
  </script>

  <script>
    // Elements
    const payNow = document.getElementById('payNow');
    const modal = document.getElementById('modalBackdrop');
    const closeModal = document.getElementById('closeModal');
    const copyUpi = document.getElementById('copyUpi');
    const confirmPay = document.getElementById('confirmPay');
    const toast = document.getElementById('toast');
    const modeSelect = document.getElementById('mode');
    const teamMembersDiv = document.getElementById('teamMembers');
    const membersList = document.getElementById('membersList');
    const addMemberBtn = document.getElementById('addMember');
    const confirmText = document.getElementById('confirmText');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const errorMsg = document.getElementById('errorMsg');
    const toggleRegs = document.getElementById('toggleRegs');
    const viewRegs = document.getElementById('viewRegs');
    const regsList = document.getElementById('regsList');

    let memberCount = 0;
    let maxMembers = 0;
    let unregisterListener = null;

    // Show Error
    function showError(msg) {
      errorMsg.textContent = msg;
      errorMsg.style.display = 'block';
      setTimeout(() => { errorMsg.style.display = 'none'; }, 5000);
    }

    // Show Toast
    function showToast(msg, isError = false) {
      toast.innerHTML = `<i class="fas fa-${isError ? 'exclamation-triangle' : 'check-circle'}"></i> ${msg}`;
      if (isError) toast.classList.add('error');
      toast.style.display = 'block';
      setTimeout(() => {
        toast.style.display = 'none';
        toast.classList.remove('error');
      }, 3000);
    }

    // Dynamic Team Members
    modeSelect.addEventListener('change', () => {
      const mode = modeSelect.value;
      teamMembersDiv.classList.toggle('active', mode !== '');
      membersList.innerHTML = '';
      memberCount = 0;
      maxMembers = mode === '4v4' ? 3 : (mode === '2v2' ? 1 : 0); // Leader + extras
      if (maxMembers > 0) {
        addMember(maxMembers); // Add default members
      }
    });

    function addMember(count = 1) {
      for (let i = 0; i < count; i++) {
        if (memberCount >= maxMembers) break;
        const memberDiv = document.createElement('div');
        memberDiv.className = 'form-row member-input';
        memberDiv.innerHTML = `
          <input type="text" placeholder="Member ${memberCount + 1} Name" required />
          <button type="button" class="remove-member" onclick="removeMember(this)">
            <i class="fas fa-trash"></i>
          </button>
        `;
        membersList.appendChild(memberDiv);
        memberCount++;
      }
    }

    function removeMember(btn) {
      if (memberCount <= maxMembers - (maxMembers > 0 ? 1 : 0)) { // Keep at least required
        btn.parentElement.remove();
        memberCount--;
      } else {
        showError('Minimum members required for this mode.');
      }
    }

    addMemberBtn.addEventListener('click', () => {
      if (memberCount < maxMembers) {
        addMember();
      } else {
        showError(`Maximum ${maxMembers} members for this mode.`);
      }
    });

    // UPI Copy
    copyUpi.onclick = () => {
      navigator.clipboard.writeText('princegamerb12@paytm').then(() => {
        const originalText = copyUpi.innerHTML;
        copyUpi.innerHTML = '<i class="fas fa-check"></i> Copied!';
        setTimeout(() => { copyUpi.innerHTML = originalText; }, 2000);
      });
    };

    // Open Modal with Validation
    payNow.onclick = () => {
      const form = document.getElementById('regForm');
      if (!form.reportValidity()) {
        showError('Please fill all required fields correctly.');
        return;
      }
      // Validate members
      const members = Array.from(membersList.querySelectorAll('input')).map(input => input.value.trim()).filter(v => v);
      if (modeSelect.value === '4v4' && members.length < 3) {
        showError('4v4 requires 3 additional members.');
        return;
      }
      if (modeSelect.value === '2v2' && members.length < 1) {
        showError('2v2 requires 1 partner.');
        return;
      }
      modal.style.display = 'flex';
    };

    closeModal.onclick = () => {
      modal.style.display = 'none';
    };

    // Confirm Payment & Save
    confirmPay.onclick = async () => {
      confirmText.style.display = 'none';
      loadingSpinner.style.display = 'inline-block';
      confirmPay.disabled = true;

      try {
        // Collect data
        const members = Array.from(membersList.querySelectorAll('input')).map(input => input.value.trim()).filter(v => v);
        const data = {
          mode: modeSelect.value,
          team: document.getElementById('team').value.trim(),
          leader: document.getElementById('leader').value.trim(),
          phone: document.getElementById('phone').value.trim(),
          members: members,
          timestamp: new Date().toISOString(),
          status: 'registered'
        };

        // Validate phone
        const phoneNum = data.phone.replace(/\D/g, '');
        if (phoneNum.length !== 10 || !/^[6-9]\d{9}$/.test(phoneNum)) {
          throw new Error('Invalid phone number.');
        }

        await window.firebasePush(window.firebaseRef(window.firebaseDb, 'registrations'), data);
        
        // Success
        modal.style.display = 'none';
        showToast('Registration Confirmed! See you in the arena.');
        document.getElementById('regForm').reset();
        membersList.innerHTML = '';
        memberCount = 0;
        teamMembersDiv.classList.remove('active');
        loadRegistrations(); // Refresh list
      } catch (e) {
        showError('Error saving registration: ' + e.message);
        showToast('Registration failed. Try again.', true);
        console.error(e);
      } finally {
        confirmText.style.display = 'inline';
        loadingSpinner.style.display = 'none';
        confirmPay.disabled = false;
      }
    };

    // Load Registrations (Demo)
    function loadRegistrations() {
      if (unregisterListener) unregisterListener();
      const registrationsRef = window.firebaseRef(window.firebaseDb, 'registrations');
      unregisterListener = window.firebaseOnValue(registrationsRef, (snapshot) => {
        const data = snapshot.val();
        regsList.innerHTML = '';
        if (data) {
          Object.values(data).forEach(reg => {
            const item = document.createElement('div');
            item.className = 'reg-item';
            item.innerHTML = `
              <strong>${reg.team || 'Unnamed'}</strong> (${reg.mode})<br>
              Leader: ${reg.leader}<br>
              Phone: ${reg.phone}<br>
              Members: ${reg.members ? reg.members.join(', ') : 'Solo'}<br>
              <small>${new Date(reg.timestamp).toLocaleString()}</small>
            `;
            regsList.appendChild(item);
          });
        } else {
          regsList.innerHTML = '<p style="color: var(--text-muted);">No registrations yet.</p>';
        }
      });
    }

    toggleRegs.addEventListener('click', () => {
      viewRegs.style.display = viewRegs.style.display === 'block' ? 'none' : 'block';
      if (viewRegs.style.display === 'block' && !unregisterListener) {
        loadRegistrations();
      }
    });

    // Close modal on backdrop click
    modal.addEventListener('click', (e) => {
      if (e.target === modal) modal.style.display = 'none';
    });

    // Enhanced Phone Validation
    document.getElementById('phone').addEventListener('input', (e) => {
      let value = e.target.value.replace(/\D/g, '');
      if (value.startsWith('91')) value = value.slice(2);
      if (!value.startsWith('0')) value = '91' + value;
      if (value.length > 12) value = value.slice(0, 12);
      e.target.value = value;
    });

    // Initial load
    loadRegistrations();
  </script>
</body>
</html>